<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.his.dao.drugrepo.DrugRepoReturnDao" >
  <resultMap id="BaseResultMap" type="com.his.entity.drugrepo.DrugRepoReturn" >
    <id column="ReturnID" property="returnid" jdbcType="CHAR" />
    <result column="StoreID" property="storeid" jdbcType="CHAR" />
    <result column="InputPrice" property="inputprice" jdbcType="DECIMAL" />
    <result column="RetailPrice" property="retailprice" jdbcType="DECIMAL" />
    <result column="LimitTime" property="limittime" jdbcType="DATE" />
    <result column="ReturnState" property="returnstate" jdbcType="INTEGER" />
    <result column="ReturnTime" property="returntime" jdbcType="TIMESTAMP" />
    <result column="ReturnNumber" property="returnnumber" jdbcType="DECIMAL" />
    <result column="ReturnMemo" property="returnmemo" jdbcType="NVARCHAR" />
    <result column="ReturnType" property="returntype" jdbcType="INTEGER" />
    
    <association column="MedicineID" property="medicine"
			select="com.his.dao.baseinfo.MedicineBaseInfoDao.selectPartByPrimaryKey" />
		<association column="ReturnEmpID" property="returnemp"
			select="com.his.dao.baseinfo.EmployeeDao.selectPartByPrimaryKey" />
		<association column="FactoryID" property="factory"
			select="com.his.dao.drugrepo.FactoryInfoDao.selectPartByPrimaryKey" />
	    <association column="DeptID" property="department"
			select="com.his.dao.baseinfo.DepartmentDao.selectPartByPrimaryKey" />
		<association column="BillCode" property="billcode"
			select="com.his.dao.drugrepo.BillRecDao.selectByPrimaryKey"></association>
  </resultMap>
  
  <sql id="Base_Column_List" >
    ReturnID, StoreID, MedicineID, InputPrice, RetailPrice, LimitTime, FactoryID, DeptID, ReturnState,
    ReturnTime, ReturnEmpID, ReturnNumber, ReturnMemo, BillCode, ReturnType
  </sql>
  
  <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.String" >
    select 
    <include refid="Base_Column_List" />
    from DrugRepoReturn
    where ReturnID = #{returnid,jdbcType=CHAR}
  </select>
  
  	<select id="selectByMap" parameterType="Map">
		select * from DrugRepoReturn
		<where>
			<if test="returnid !=null and returnid !=''">
				and ReturnID = #{returnid}
			</if>
		</where>
	</select>
  
  
  <delete id="deleteByPrimaryKey" parameterType="java.lang.String" >
    delete from DrugRepoReturn
    where ReturnID = #{returnid,jdbcType=CHAR}
  </delete>
  
  	<delete id="deleteByMap" parameterType="Map">
		delete from DrugRepoReturn
		<where>
			<if test="returnid !=null and returnid !=''">
				and ReturnID = #{returnid}
			</if>
		</where>
	</delete>
  
  <insert id="insertSelective" parameterType="com.his.entity.drugrepo.DrugRepoReturn" >
    insert into DrugRepoReturn
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="returnid != null" >
        ReturnID,
      </if>
      <if test="storeid != null" >
        StoreID,
      </if>
      <if test="medicine != null" >
        MedicineID,
      </if>
      <if test="inputprice != null" >
        InputPrice,
      </if>
      <if test="retailprice != null" >
        RetailPrice,
      </if>
      <if test="limittime != null" >
        LimitTime,
      </if>
      <if test="factory != null" >
        FactoryID,
      </if>
      <if test="department != null" >
        DeptID,
      </if>
      <if test="returnstate != null" >
        ReturnState,
      </if>
      <if test="returntime != null" >
        ReturnTime,
      </if>
      <if test="returnemp != null" >
        ReturnEmpID,
      </if>
      <if test="returnnumber != null" >
        ReturnNumber,
      </if>
      <if test="returnmemo != null" >
        ReturnMemo,
      </if>
      <if test="billcode != null" >
        BillCode,
      </if>
      <if test="returntype != null" >
        ReturnType,
      </if>      
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="returnid != null" >
        #{returnid,jdbcType=CHAR},
      </if>
      <if test="storeid != null" >
        #{storeid,jdbcType=CHAR},
      </if>
      <if test="medicine != null" >
        #{medicine.medicineid,jdbcType=CHAR},
      </if>
      <if test="inputprice != null" >
        #{inputprice,jdbcType=DECIMAL},
      </if>
      <if test="retailprice != null" >
        #{retailprice,jdbcType=DECIMAL},
      </if>
      <if test="limittime != null" >
        #{limittime,jdbcType=DATE},
      </if>
      <if test="factory != null" >
        #{factory.factoryid,jdbcType=CHAR},
      </if>
      <if test="department != null" >
        #{department.deptid,jdbcType=CHAR},
      </if>
      <if test="returnstate != null" >
        #{returnstate,jdbcType=INTEGER},
      </if>
      <if test="returntime != null" >
        #{returntime,jdbcType=TIMESTAMP},
      </if>
      <if test="returnemp != null" >
        #{returnemp.empid,jdbcType=CHAR},
      </if>
      <if test="returnnumber != null" >
        #{returnnumber,jdbcType=DECIMAL},
      </if>
      <if test="returnmemo != null" >
        #{returnmemo,jdbcType=NVARCHAR},
      </if>
      <if test="billcode != null" >
        #{billcode.billrecid,jdbcType=CHAR},
      </if>
      <if test="returntype != null" >
        #{returntype,jdbcType=INTEGER},
      </if>      
    </trim>
  </insert>
  
  <update id="updateByPrimaryKeySelective" parameterType="com.his.entity.drugrepo.DrugRepoReturn" >
    update DrugRepoReturn
    <set >
      <if test="storeid != null" >
        StoreID = #{storeid,jdbcType=CHAR},
      </if>
      <if test="medicine != null" >
        MedicineID = #{medicine.medicineid,jdbcType=CHAR},
      </if>
      <if test="inputprice != null" >
        InputPrice = #{inputprice,jdbcType=DECIMAL},
      </if>
      <if test="retailprice != null" >
        RetailPrice = #{retailprice,jdbcType=DECIMAL},
      </if>
      <if test="limittime != null" >
        LimitTime = #{limittime,jdbcType=DATE},
      </if>
      <if test="factory != null" >
        FactoryID = #{factory.factoryid,jdbcType=CHAR},
      </if>
      <if test="department != null" >
        DeptID = #{department.deptid,jdbcType=CHAR},
      </if>
      <if test="returnstate != null" >
        ReturnState = #{returnstate,jdbcType=INTEGER},
      </if>
      <if test="returntime != null" >
        ReturnTime = #{returntime,jdbcType=TIMESTAMP},
      </if>
      <if test="returnemp != null" >
        ReturnEmpID = #{returnemp.empid,jdbcType=CHAR},
      </if>
      <if test="returnnumber != null" >
        ReturnNumber = #{returnnumber,jdbcType=DECIMAL},
      </if>
      <if test="returnmemo != null" >
        ReturnMemo = #{returnmemo,jdbcType=NVARCHAR},
      </if>
      <if test="billcode != null" >
        BillCode = #{billcode.billrecid,jdbcType=CHAR},
      </if>
      <if test="returntype != null" >
        ReturnType = #{returntype,jdbcType=INTEGER},
      </if>      
    </set>
    where ReturnID = #{returnid,jdbcType=CHAR}
  </update>
  
	<select id="findDrugRepoReturn" parameterType="Map" resultMap="BaseResultMap">
		select * from DrugRepoReturn
		<where>
			<!-- 根据入库操作员查询入库记录 -->
			<if test="returnemp !=null and returnemp !=''">
				and ReturnEmpID = #{returnemp}
			</if>
			<if test="billcode !=null and billcode !=''">
				and BillCode = #{billcode}
			</if>
			<if test="returnstate !=null ">
				and ReturnState = #{returnstate}
			</if>
		</where>
		<if test="start!=null and size!=null">
			order by ReturnID offset ${start} rows fetch next ${size} rows only
		</if>
	</select>

	<select id="getTotalDrugRepoReturn" parameterType="Map"
		resultType="Long">
		select count(*) from DrugRepoReturn
		<where>
			<if test="returnemp !=null and returnemp !=''">
				and ReturnEmpID = #{returnemp}
			</if>
			<if test="billcode !=null and billcode !=''">
				and BillCode = #{billcode}
			</if>
			<if test="returnstate !=null ">
				and ReturnState = #{returnstate}
			</if>
		</where>
	</select>
	
	<select id="getMaxID" parameterType="Map" resultType="String">
		select MAX(ReturnID) from DrugRepoReturn
		<where>
			<if test="prefix !=null and prefix !=''">
				and ReturnID like #{prefix}
			</if>
		</where>
	</select>

</mapper>