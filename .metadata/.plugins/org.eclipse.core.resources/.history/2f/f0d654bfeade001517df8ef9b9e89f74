<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.his.dao.downpublic.TestApplyDao" >
  <resultMap id="BaseResultMap" type="com.his.entity.downpublic.TestApply" >
    <id column="ApplyID" property="applyid" jdbcType="CHAR" />
    <result column="ICCardID" property="iccardid" jdbcType="VARCHAR" />
    <result column="IsHos" property="ishos" jdbcType="BIT" />
    <result column="Purpose" property="purpose" jdbcType="NVARCHAR" />
    
    <result column="SampleDescription" property="sampledescription" jdbcType="NVARCHAR" />
    <result column="PriorityLevel" property="prioritylevel" jdbcType="BIT" />
    
    <result column="ApplyTime" property="applytime" jdbcType="TIMESTAMP" />
    <result column="ApplyState" property="applystate" jdbcType="INTEGER" />
    <result column="ExecuteTime" property="executetime" jdbcType="TIMESTAMP" />
    <result column="UnUsed1" property="unused1" jdbcType="NVARCHAR" />
    <result column="UnUsed2" property="unused2" jdbcType="NVARCHAR" />
    <result column="UnUsed3" property="unused3" jdbcType="NVARCHAR" />
    
    <association column="BillCode" property="billrec"
			select="com.his.dao.drugrepo.BillRecDao.selectByPrimaryKey" />    
    <association column="OutpatientMarkID" property="mark"
			select="com.his.dao.outpatientmark.BOutpatientMarkDao.selectByPrimaryKey" />
	<association column="HosCode" property="hosregister"
			select="com.his.dao.hospital.HosRegisterDao.selectByPrimaryKey" />
	<association column="PatientID" property="patient"
			select="com.his.dao.iccard.APatientInfoDao.selectByPrimaryKey" />
	<association column="ServiceItemID" property="serviceitem"
			select="com.his.dao.baseinfo.ServiceItemDao.selectByPrimaryKey" />
	<association column="TestInfID" property="testinformation"
			select="com.his.dao.baseinfo.TestInformationDao.selectByPrimaryKey" />	
	<association column="ApplyEmpID" property="applyemployee"
			select="com.his.dao.baseinfo.EmployeeDao.selectPartByPrimaryKey" />
	<association column="ApplyDeptID" property="applydepartment"
			select="com.his.dao.baseinfo.DepartmentDao.selectPartByPrimaryKey" />
	<association column="ExecuteEmpID" property="executeemployee"
			select="com.his.dao.baseinfo.EmployeeDao.selectPartByPrimaryKey" />
	<association column="ExecuteDeptID" property="executedepartment"
			select="com.his.dao.baseinfo.DepartmentDao.selectPartByPrimaryKey" />
  </resultMap>
  
  <sql id="Base_Column_List" >
    ApplyID, BillCode, OutpatientMarkID, HosCode, ICCardID, PatientID, ServiceItemID, IsHos, TestInfID, Purpose,
    SampleDescription, PriorityLevel,
    ApplyDeptID, ApplyEmpID, ApplyTime, ApplyState, ExecuteDeptID, ExecuteEmpID, 
    ExecuteTime, UnUsed1, UnUsed2, UnUsed3
  </sql>
  
  <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.String" >
    select 
    <include refid="Base_Column_List" />
    from TestApply
    where ApplyID = #{applyid,jdbcType=CHAR}
  </select>
  
  <select id="selectByMap" parameterType="Map" resultMap="BaseResultMap">
		select * from TestApply
		<where>
			<if test="applyid !=null and applyid !=''">
				and ApplyID = #{applyid}
			</if>
		</where>
	</select>
  
  <delete id="deleteByPrimaryKey" parameterType="java.lang.String" >
    delete from  TestApply
    where ApplyID = #{applyid,jdbcType=CHAR}
  </delete>
  
  <delete id="deleteByMap" parameterType="Map">
		delete from TestApply
		<where>
			<if test="applyid !=null and applyid !=''">
				and ApplyID = #{applyid}
			</if>
			<if test="markid !=null and markid !=''">
				and OutpatientMarkID = #{markid}
			</if>
			<if test="iccardid !=null and iccardid !=''">
				and ICCardID = #{iccardid}
			</if>
			<if test="patientid !=null and patientid !=''">
				and PatientID = #{patientid}
			</if>
			<if test="applystate !=null">
				and ApplyState = ${applystate}
			</if>				
		</where>
	</delete>
  
  <insert id="insertSelective" parameterType="com.his.entity.downpublic.TestApply" >
    insert into TestApply
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="applyid != null" >
        ApplyID,
      </if>
      <if test="billrec != null" >
        BillCode,
      </if>
      <if test="mark != null" >
        OutpatientMarkID,
      </if>
      <if test="hosregister != null" >
        HosCode,
      </if>
      <if test="iccardid != null" >
        ICCardID,
      </if>
      <if test="patient != null" >
        PatientID,
      </if>
      <if test="ishos != null" >
        IsHos,
      </if>
      <if test="serviceitem != null" >
        ServiceItemID,
      </if>
      <if test="testinformation != null" >
        TestInfID,
      </if>
      <if test="purpose != null" >
        Purpose,
      </if>
      <if test="sampledescription != null" >
        SampleDescription,
      </if>
      <if test="prioritylevel != null" >
        PriorityLevel,
      </if>
      <if test="applydepartment != null" >
        ApplyDeptID,
      </if>
      <if test="applyemployee != null" >
        ApplyEmpID,
      </if>
      <if test="applytime != null" >
        ApplyTime,
      </if>
      <if test="applystate != null" >
        ApplyState,
      </if>
      <if test="executedepartment != null" >
        ExecuteDeptID,
      </if>
      <if test="executeemployee != null" >
        ExecuteEmpID,
      </if>
      <if test="executetime != null" >
        ExecuteTime,
      </if>
      <if test="unused1 != null" >
        UnUsed1,
      </if>
      <if test="unused2 != null" >
        UnUsed2,
      </if>
      <if test="unused3 != null" >
        UnUsed3,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="applyid != null" >
        #{applyid,jdbcType=CHAR},
      </if>
      <if test="billrec != null" >
        #{billrec.billrecid,jdbcType=CHAR},
      </if>
      <if test="mark != null" >
        #{mark.markid,jdbcType=CHAR},
      </if>
      <if test="hosregister != null" >
        #{hosregister.hoscode,jdbcType=CHAR},
      </if>
      <if test="iccardid != null" >
        #{iccardid,jdbcType=VARCHAR},
      </if>
      <if test="patient != null" >
        #{patient.patientid,jdbcType=CHAR},
      </if>
      <if test="ishos != null" >
        #{ishos,jdbcType=BIT},
      </if>
      <if test="serviceitem != null" >
        #{serviceitem.serviceitemid,jdbcType=CHAR},
      </if>
      <if test="testinformation != null" >
        #{testinformation.testinfid,jdbcType=NVARCHAR},
      </if>
      <if test="purpose != null" >
        #{purpose,jdbcType=NVARCHAR},
      </if>
      <if test="sampledescription != null" >
        #{sampledescription,jdbcType=NVARCHAR},
      </if>
      <if test="prioritylevel != null" >
        #{prioritylevel,jdbcType=BIT},
      </if>
      <if test="applydepartment != null" >
        #{applydepartment.deptid,jdbcType=CHAR},
      </if>
      <if test="applyemployee != null" >
        #{applyemployee.empid,jdbcType=CHAR},
      </if>
      <if test="applytime != null" >
        #{applytime,jdbcType=TIMESTAMP},
      </if>
      <if test="applystate != null" >
        #{applystate,jdbcType=INTEGER},
      </if>
      <if test="executedepartment != null" >
        #{executedepartment.deptid,jdbcType=CHAR},
      </if>
      <if test="executeemployee != null" >
        #{executeemployee.empid,jdbcType=CHAR},
      </if>
      <if test="executetime != null" >
        #{executetime,jdbcType=TIMESTAMP},
      </if>
      <if test="unused1 != null" >
        #{unused1,jdbcType=NVARCHAR},
      </if>
      <if test="unused2 != null" >
        #{unused2,jdbcType=NVARCHAR},
      </if>
      <if test="unused3 != null" >
        #{unused3,jdbcType=NVARCHAR},
      </if>
    </trim>
  </insert>
  
  <update id="updateByPrimaryKeySelective" parameterType="com.his.entity.downpublic.TestApply" >
    update TestApply
    <set >
      <if test="billrec != null" >
        BillCode = #{billrec.billrecid,jdbcType=CHAR},
      </if>
      <if test="mark != null" >
        OutpatientMarkID = #{mark.markid,jdbcType=CHAR},
      </if>
      <if test="hosregister != null" >
        HosCode = #{hosregister.hoscode,jdbcType=CHAR},
      </if>
      <if test="iccardid != null" >
        ICCardID = #{iccardid,jdbcType=VARCHAR},
      </if>
      <if test="patient != null" >
        PatientID = #{patient.patientid,jdbcType=CHAR},
      </if>
      <if test="ishos != null" >
        IsHos = #{ishos,jdbcType=BIT},
      </if>
      <if test="serviceitem != null" >
        ServiceItemID = #{serviceitem.serviceitemid,jdbcType=CHAR},
      </if>
      <if test="testinformation != null" >
        TestInfID = #{testinformation.testinfid,jdbcType=NVARCHAR},
      </if>
      <if test="purpose != null" >
        Purpose = #{purpose,jdbcType=NVARCHAR},
      </if>
      <if test="sampledescription != null" >
        SampleDescription = #{sampledescription,jdbcType=NVARCHAR},
      </if>
      <if test="prioritylevel != null" >
        PriorityLevel = #{prioritylevel,jdbcType=BIT},
      </if>
      <if test="applydepartment != null" >
        ApplyDeptID = #{applydepartment.deptid,jdbcType=CHAR},
      </if>
      <if test="applyemployee != null" >
        ApplyEmpID = #{applyemployee.empid,jdbcType=CHAR},
      </if>
      <if test="applytime != null" >
        ApplyTime = #{applytime,jdbcType=TIMESTAMP},
      </if>
      <if test="applystate != null" >
        ApplyState = #{applystate,jdbcType=INTEGER},
      </if>
      <if test="executedepartment != null" >
        ExecuteDeptID = #{executedepartment.deptid,jdbcType=CHAR},
      </if>
      <if test="executeemployee != null" >
        ExecuteEmpID = #{executeemployee.empid,jdbcType=CHAR},
      </if>
      <if test="executetime != null" >
        ExecuteTime = #{executetime,jdbcType=TIMESTAMP},
      </if>
      <if test="unused1 != null" >
        UnUsed1 = #{unused1,jdbcType=NVARCHAR},
      </if>
      <if test="unused2 != null" >
        UnUsed2 = #{unused2,jdbcType=NVARCHAR},
      </if>
      <if test="unused3 != null" >
        UnUsed3 = #{unused3,jdbcType=NVARCHAR},
      </if>
    </set>
    where ApplyID = #{applyid,jdbcType=CHAR}
  </update>
  
  <select id="findTestApply" parameterType="Map" resultMap="BaseResultMap">
		select * from TestApply
		<where>
			<if test="applyid !=null and applyid !=''">
				and ApplyID = #{applyid}
			</if>
			<if test="deptid !=null and deptid !=''">
				and DeptID = #{deptid}
			</if>
			<if test="empid !=null and empid !=''">
				and EmpID = #{empid}
			</if>
			<if test="billcode !=null and billcode !=''">
				and BillCode = #{billcode}
			</if>
			<if test="markid !=null and markid !=''">
				and OutpatientMarkID = #{markid}
			</if>
			<if test="iccardid !=null and iccardid !=''">
				and ICCardID = #{iccardid}
			</if>
			<if test="hoscode !=null and hoscode !=''">
				and HosCode = #{hoscode}
			</if>
			<if test="patientid !=null and patientid !=''">
				and PatientID = #{patientid}
			</if>
			<if test="applystate !=null">
				and ApplyState = ${applystate}
			</if>
			<if test="executedeptid !=null and executedeptid !=''">
				and ExecuteDeptID = #{executedeptid}
			</if>
			<if test="source !=null">
				and IsHos = #{ishos}
			</if>
			<if test="hoscode !=null and hoscode !=''">
				and HosCode = #{hoscode}
			</if>
		</where>
		<if test="start!=null and size!=null">
			order by ApplyID offset ${start} rows fetch next
			${size} rows only
		</if>
	</select>

	<select id="getTotalTestApply" parameterType="Map"
		resultType="Long">
		select count(*) from TestApply
		<where>
			<if test="applyid !=null and applyid !=''">
				and ApplyID = #{applyid}
			</if>
			<if test="deptid !=null and deptid !=''">
				and ApplyDeptID = #{deptid}
			</if>
			<if test="empid !=null and empid !=''">
				and ApplyEmpID = #{empid}
			</if>
			<if test="billcode !=null and billcode !=''">
				and BillCode = #{billcode}
			</if>
			<if test="markid !=null and markid !=''">
				and OutpatientMarkID = #{markid}
			</if>
			<if test="iccardid !=null and iccardid !=''">
				and ICCardID = #{iccardid}
			</if>
			<if test="hoscode !=null and hoscode !=''">
				and HosCode = #{hoscode}
			</if>
			<if test="patientid !=null and patientid !=''">
				and PatientID = #{patientid}
			</if>
			<if test="applystate !=null">
				and ApplyState = ${applystate}
			</if>
			<if test="executedeptid !=null and executedeptid !=''">
				and ExecuteDeptID = #{executedeptid}
			</if>
			<if test="source !=null">
				and IsHos = #{ishos}
			</if>
			<if test="hoscode !=null and hoscode !=''">
				and HosCode = #{hoscode}
			</if>
		</where>
	</select>

	<select id="getMaxID" parameterType="Map" resultType="String">
		select MAX(ApplyID) from TestApply
		<where>
			<!-- 医生ID+日期 -->
			<if test="prefix!=null and prefix!='' ">
				and ApplyID like #{prefix}
			</if>
		</where>
	</select>
</mapper>